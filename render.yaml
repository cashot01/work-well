# render.yaml ‚Äî WorkWell Global Solution 2025
services:
  # üêò Banco de dados PostgreSQL
  - type: postgres
    name: workwell-db
    databaseName: workwell_db
    user: workwell_user
    region: oregon

  # üêá RabbitMQ via CloudAMQP (add-on)
  - type: addon
    addon: cloudamqp
    name: workwell-rabbitmq
    plan: lemur
    region: oregon

  # üöÄ Aplica√ß√£o Spring Boot (Docker)
  - type: web
    name: workwell-app
    runtime: docker
    region: oregon
    envVars:
      # üîê Banco de dados (Render injeta DATABASE_URL automaticamente)
      - key: SPRING_DATASOURCE_URL
        value: ${DATABASE_URL}
        # Spring Boot 3.1+ suporta postgres:// diretamente!
        # Se quiser for√ßar JDBC, use: jdbc:postgresql://${DATABASE_URL#postgres://}
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: workwell-db
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: workwell-db
          property: password

      # üêá RabbitMQ (CloudAMQP injeta CLOUDAMQP_URL)
      # O Spring Boot consegue configurar o RabbitMQ automaticamente a partir da CLOUDAMQP_URL.
      - key: SPRING_RABBITMQ_ADDRESSES
        fromAddon:
          name: workwell-rabbitmq
          property: url
      - key: SPRING_RABBITMQ_SSL_ENABLED
        value: "true"

      # ü§ñ Hugging Face (adicione sua chave no dashboard)
      - key: HUGGINGFACE_API_KEY
        sync: false  # voc√™ define no dashboard (n√£o commita!)

      # üì¶ Hibernate/Flyway
      - key: SPRING_JPA_HIBERNATE_DDL_AUTO
        value: "none"
      - key: SPRING_FLYWAY_ENABLED
        value: "true"
      - key: SPRING_FLYWAY_BASELINE_ON_MIGRATE
        value: "true"

      # üåê Porta (necess√°ria para Spring Boot no Render)
      - key: SERVER_PORT
        value: "8080"

      # ‚öôÔ∏è Ativa√ß√£o do Perfil 'render'
      - key: SPRING_PROFILES_ACTIVE
        value: "render"

    healthCheckPath: /actuator/health
    healthCheckInterval: 30